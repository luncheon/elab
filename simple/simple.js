(()=>{var C=(d,n)=>{let m=document.createElement("template");m.innerHTML=d;let u=m.content.firstElementChild;return u.classList.add(n),()=>u.cloneNode(!0)},P=d=>d.map(n=>n.checkbox.checked&&n.barItem.getAttribute("data-value")).filter(Boolean),S=d=>{let n,m="elab-open",u="elab-popup-dropup",v="elab-popup-dropdown",h="data-selected",M="data-disabled",O="data-selected-all",R="data-placeholder",L=".elab",E="input[type=checkbox]",y=".elab-popup-item",_=C(d.popupTemplate,"elab-popup"),w=C(d.popupItemTemplate,"elab-popup-item"),H=(e,l)=>{e.checkbox.disabled||(e.checkbox.checked=l,e.barItem.toggleAttribute(h,l),e.popupItem.toggleAttribute(h,l))},k=(e,l)=>{if(e){let t=l.every(({checkbox:a})=>a.disabled||!a.checked);e.checkbox.checked=!t,e.checkbox.indeterminate=!t&&!l.every(({checkbox:a})=>a.disabled||a.checked)}},g=(e,l)=>{let t=l.getBoundingClientRect();e.style.left=t.left+"px",e.style.width=t.width+"px",e.classList.contains(u)?(e.style.maxHeight=t.top-8+"px",e.style.top=t.top-e.offsetHeight+"px"):(e.style.maxHeight=window.innerHeight-t.bottom-20+"px",e.style.top=t.top+l.offsetHeight+"px")},b=()=>{n?.bar.dispatchEvent(new CustomEvent("close",{bubbles:!0,cancelable:!0,detail:{values:P(n.items)}}))&&(n.bar.classList.remove(m),n.bar.focus(),n.popup.remove(),n=void 0)},D=(e,l)=>{let t=[],a;for(let o of e.firstElementChild.children){if(o.hasAttribute(R))continue;let i=l.appendChild(w());for(let s of o.getAttributeNames())i.setAttribute(s,o.getAttribute(s));i.querySelector("slot").replaceWith(...o.cloneNode(!0).childNodes);let r=i.querySelector(E);r&&(o.hasAttribute(O)?a={barItem:o,popupItem:i,checkbox:r}:(r.checked=o.hasAttribute(h),r.disabled=o.hasAttribute(M),t.push({barItem:o,popupItem:i,checkbox:r})))}return k(a,t),[t,a]},I=e=>{if(n?.bar===e)return;n&&b();let l=e.getBoundingClientRect(),t=_(),a=t.querySelector("slot"),[o,i]=D(e,a.parentElement);a.remove(),n={bar:e,popup:t,items:o,itemSelectedAll:i},e.classList.add(m),t.className=(t.className+" "+(e.getAttribute("data-popup-class")||"")).trim(),t.style.cssText=e.getAttribute("data-popup-style")||"",e.parentElement.insertBefore(t,e),t.classList.add(l.top*1.75>window.innerHeight&&l.bottom+t.offsetHeight>window.innerHeight?u:v),g(t,e);let r=(s,c)=>{if(s===i?.checkbox){for(let p of o)H(p,c);i.checkbox.checked=c,i.checkbox.indeterminate=!1}else{let p=o.find(f=>f.checkbox===s);if(!p)return;H(p,c),k(i,o)}g(t,e),e.dispatchEvent(new CustomEvent("change",{bubbles:!0,detail:{values:P(o)}}))};t.addEventListener("pointerover",s=>s.target.closest(y)?.querySelector(E)?.focus()),t.addEventListener("change",s=>{let c=s.target;c.matches(E)&&(r(c,c.checked),s.stopPropagation())}),t.addEventListener("keydown",s=>{let c=s.target;if(!c.matches(E))return;let p=s.keyCode;if(p===38||p===40){s.preventDefault();let f=p===38?"previousElementSibling":"nextElementSibling";for(let T=c.closest(y)?.[f];T;T=T[f]){let x=T.querySelector(E);if(!x?.disabled){x?.focus();break}}}else p===13&&(s.preventDefault(),r(c,!c.checked))}),setTimeout(()=>t.getElementsByTagName("input")[0]?.focus()),d.onOpen?.(n)},A=()=>n&&g(n.popup,n.bar);addEventListener("resize",A),addEventListener("scroll",A,!0),addEventListener("pointerdown",e=>{let l=e.target,t=l.closest(L);t?t===n?.bar?b():I(t):n&&(n.popup.contains(l)?e.preventDefault():b())}),addEventListener("keydown",e=>{let l=e.target,t=e.keyCode;t===27&&n?(e.preventDefault(),b()):t===32&&l.matches(L)?(e.preventDefault(),l===n?.popup?b():I(l)):(t===38||t===40)&&l.matches(L)&&(e.preventDefault(),I(l))})};S({popupTemplate:"<ul><slot></slot></ul>",popupItemTemplate:"<li><label class=elab-label><input class=elab-checkbox type=checkbox><div class=elab-content><slot></slot></div></label></li>"});})();
