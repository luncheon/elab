(()=>{var A=(d,l)=>{let m=document.createElement("template");m.innerHTML=d;let b=m.content.firstElementChild;return b.classList.add(l),()=>b.cloneNode(!0)},C=d=>d.map(l=>l.checkbox.checked&&l.barItem.getAttribute("data-value")).filter(Boolean),M=d=>{let l,m="elab-popup-dropup",b="elab-popup-dropdown",h="data-selected",P="data-disabled",S="data-selected-all",v="data-placeholder",L=".elab",u="input[type=checkbox]",y=".elab-popup-item",w=A(d.popupTemplate,"elab-popup"),R=A(d.popupItemTemplate,"elab-popup-item"),H=(e,n)=>{e.checkbox.disabled||(e.checkbox.checked=n,e.barItem.toggleAttribute(h,n),e.popupItem.toggleAttribute(h,n))},k=(e,n)=>{if(e){let t=n.every(({checkbox:a})=>a.disabled||!a.checked);e.checkbox.checked=!t,e.checkbox.indeterminate=!t&&!n.every(({checkbox:a})=>a.disabled||a.checked)}},g=(e,n)=>{let t=n.getBoundingClientRect();e.style.left=n.offsetLeft+"px",e.style.width=n.offsetWidth+"px",e.classList.contains(m)?(e.style.maxHeight=t.top-8+"px",e.style.top=n.offsetTop-e.offsetHeight+"px"):(e.style.maxHeight=window.innerHeight-t.bottom-20+"px",e.style.top=n.offsetTop+n.offsetHeight+"px")},E=()=>{l?.bar.dispatchEvent(new CustomEvent("close",{bubbles:!0,cancelable:!0,detail:{values:C(l.items)}}))&&(l.bar.focus(),l.popup.remove(),l=void 0)},D=(e,n)=>{let t=[],a;for(let o of e.firstElementChild.children){if(o.hasAttribute(v))continue;let i=n.appendChild(R());for(let s of o.getAttributeNames())i.setAttribute(s,o.getAttribute(s));i.querySelector("slot").replaceWith(...o.cloneNode(!0).childNodes);let r=i.querySelector(u);r&&(o.hasAttribute(S)?a={barItem:o,popupItem:i,checkbox:r}:(r.checked=o.hasAttribute(h),r.disabled=o.hasAttribute(P),t.push({barItem:o,popupItem:i,checkbox:r})))}return k(a,t),[t,a]},I=e=>{if(l?.bar===e)return;l&&E();let n=e.getBoundingClientRect(),t=w(),a=t.querySelector("slot"),[o,i]=D(e,a.parentElement);a.remove(),l={bar:e,popup:t,items:o,itemSelectedAll:i},e.parentElement.insertBefore(t,e),t.classList.add(n.top*1.75>window.innerHeight&&n.bottom+t.offsetHeight>window.innerHeight?m:b),g(t,e),t.style.left=n.left+"px",t.style.width=n.width+"px";let r=(s,c)=>{if(s===i?.checkbox){for(let p of o)H(p,c);i.checkbox.checked=c,i.checkbox.indeterminate=!1}else{let p=o.find(f=>f.checkbox===s);if(!p)return;H(p,c),k(i,o)}g(t,e),e.dispatchEvent(new CustomEvent("change",{bubbles:!0,detail:{values:C(o)}}))};t.addEventListener("pointerover",s=>s.target.closest(y)?.querySelector(u)?.focus()),t.addEventListener("change",s=>{let c=s.target;c.matches(u)&&(r(c,c.checked),s.stopPropagation())}),t.addEventListener("keydown",s=>{let c=s.target;if(!c.matches(u))return;let p=s.keyCode;if(p===38||p===40){s.preventDefault();let f=p===38?"previousElementSibling":"nextElementSibling";for(let T=c.closest(y)?.[f];T;T=T[f]){let x=T.querySelector(u);if(!x?.disabled){x?.focus();break}}}else p===13&&(s.preventDefault(),r(c,!c.checked))}),setTimeout(()=>t.getElementsByTagName("input")[0]?.focus())};addEventListener("resize",()=>l&&g(l.popup,l.bar)),addEventListener("pointerdown",e=>{let n=e.target,t=n.closest(L);t?t===l?.bar?E():I(t):l&&(l.popup.contains(n)?e.preventDefault():E())}),addEventListener("keydown",e=>{let n=e.target,t=e.keyCode;t===27&&l?(e.preventDefault(),E()):t===32&&n.matches(L)?(e.preventDefault(),n===l?.popup?E():I(n)):(t===38||t===40)&&n.matches(L)&&(e.preventDefault(),I(n))})};M({popupTemplate:"<ul><slot></slot></ul>",popupItemTemplate:"<li><label class=elab-label><input class=elab-checkbox type=checkbox><div class=elab-content><slot></slot></div></label></li>"});})();
