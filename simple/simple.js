(()=>{var A=(m,o)=>{let d=document.createElement("template");d.innerHTML=m;let b=d.content.firstElementChild;return b.classList.add(o),()=>b.cloneNode(!0)},C=m=>m.map(o=>o.checkbox.checked&&o.barItem.getAttribute("data-value")).filter(Boolean),M=m=>{let o,d="elab-popup-dropup",b="elab-popup-dropdown",T="data-selected",P="data-disabled",S="data-selected-all",v="data-placeholder",L=".elab",u="input[type=checkbox]",y=".elab-popup-item",w=A(m.popupTemplate,"elab-popup"),R=A(m.popupItemTemplate,"elab-popup-item"),H=(e,n)=>{e.checkbox.disabled||(e.checkbox.checked=n,e.barItem.toggleAttribute(T,n),e.popupItem.toggleAttribute(T,n))},k=(e,n)=>{if(e){let t=l=>l.checkbox.checked,i=!n.some(t);e.checkbox.checked=!i,e.checkbox.indeterminate=!i&&!n.every(t)}},g=(e,n)=>{let t=n.getBoundingClientRect();e.style.left=n.offsetLeft+"px",e.style.width=n.offsetWidth+"px",e.classList.contains(d)?(e.style.maxHeight=t.top-8+"px",e.style.top=n.offsetTop-e.offsetHeight+"px"):(e.style.maxHeight=window.innerHeight-t.bottom-20+"px",e.style.top=n.offsetTop+n.offsetHeight+"px")},E=()=>{o?.bar.dispatchEvent(new CustomEvent("close",{bubbles:!0,cancelable:!0,detail:{values:C(o.items)}}))&&(o.bar.focus(),o.popup.remove(),o=void 0)},D=(e,n)=>{let t=[],i;for(let l of e.firstElementChild.children){if(l.hasAttribute(v))continue;let a=n.appendChild(R());for(let s of l.getAttributeNames())a.setAttribute(s,l.getAttribute(s));a.querySelector("slot").replaceWith(...l.cloneNode(!0).childNodes);let r=a.querySelector(u);r&&(l.hasAttribute(S)?i={barItem:l,popupItem:a,checkbox:r}:(r.checked=l.hasAttribute(T),r.disabled=l.hasAttribute(P),t.push({barItem:l,popupItem:a,checkbox:r})))}return k(i,t),[t,i]},I=e=>{if(o?.bar===e)return;o&&E();let n=e.getBoundingClientRect(),t=w(),i=t.querySelector("slot"),[l,a]=D(e,i.parentElement);i.remove(),o={bar:e,popup:t,items:l,itemSelectedAll:a},e.parentElement.insertBefore(t,e),t.classList.add(n.top*1.75>window.innerHeight&&n.bottom+t.offsetHeight>window.innerHeight?d:b),g(t,e),t.style.left=n.left+"px",t.style.width=n.width+"px";let r=(s,c)=>{if(s===a?.checkbox){for(let p of l)H(p,c);a.checkbox.checked=c,a.checkbox.indeterminate=!1}else{let p=l.find(f=>f.checkbox===s);if(!p)return;H(p,c),k(a,l)}g(t,e),e.dispatchEvent(new CustomEvent("change",{bubbles:!0,detail:{values:C(l)}}))};t.addEventListener("pointerover",s=>s.target.closest(y)?.querySelector(u)?.focus()),t.addEventListener("change",s=>{let c=s.target;c.matches(u)&&(r(c,c.checked),s.stopPropagation())}),t.addEventListener("keydown",s=>{let c=s.target;if(!c.matches(u))return;let p=s.keyCode;if(p===38||p===40){s.preventDefault();let f=p===38?"previousElementSibling":"nextElementSibling";for(let h=c.closest(y)?.[f];h;h=h[f]){let x=h.querySelector(u);if(!x?.disabled){x?.focus();break}}}else p===13&&(s.preventDefault(),r(c,!c.checked))}),setTimeout(()=>t.getElementsByTagName("input")[0]?.focus())};addEventListener("resize",()=>o&&g(o.popup,o.bar)),addEventListener("pointerdown",e=>{let n=e.target,t=n.closest(L);t?t===o?.bar?E():I(t):o&&!o.popup.contains(n)&&E()}),addEventListener("keydown",e=>{let n=e.target,t=e.keyCode;t===27&&o?(e.preventDefault(),E()):t===32&&n.matches(L)?(e.preventDefault(),n===o?.popup?E():I(n)):(t===38||t===40)&&n.matches(L)&&(e.preventDefault(),I(n))})};M({popupTemplate:"<ul><slot></slot></ul>",popupItemTemplate:"<li><label class=elab-label><input class=elab-checkbox type=checkbox><div class=elab-content><slot></slot></div></label></li>"});})();
