(()=>{var x=(d,n)=>{let u=document.createElement("template");u.innerHTML=d;let m=u.content.firstElementChild;return m.classList.add(n),()=>m.cloneNode(!0)},C=d=>d.map(n=>n.checkbox.checked&&n.barItem.getAttribute("data-value")).filter(Boolean),P=d=>{let n,u="elab-open",m="elab-popup-dropup",S="elab-popup-dropdown",L="data-selected",v="data-disabled",M="data-selected-all",O="data-placeholder",g=".elab",b="input[type=checkbox]",I=".elab-popup-item",R=x(d.popupTemplate,"elab-popup"),_=x(d.popupItemTemplate,"elab-popup-item"),H=(e,l)=>{e.checkbox.disabled||(e.checkbox.checked=l,e.barItem.toggleAttribute(L,l),e.popupItem.toggleAttribute(L,l))},k=(e,l)=>{if(e){let t=l.every(({checkbox:a})=>a.disabled||!a.checked);e.checkbox.checked=!t,e.checkbox.indeterminate=!t&&!l.every(({checkbox:a})=>a.disabled||a.checked)}},f=(e,l)=>{let t=l.getBoundingClientRect();e.style.left=t.left+"px",e.style.width=t.width+"px",e.classList.contains(m)?(e.style.maxHeight=t.top-8+"px",e.style.top=t.top-e.offsetHeight+"px"):(e.style.maxHeight=window.innerHeight-t.bottom-20+"px",e.style.top=t.top+l.offsetHeight+"px")},E=()=>{n?.bar.dispatchEvent(new CustomEvent("close",{bubbles:!0,cancelable:!0,detail:{values:C(n.items)}}))&&(n.bar.classList.remove(u),n.bar.focus(),n.popup.remove(),n=void 0)},w=(e,l)=>{let t=[],a;for(let o of e.firstElementChild.children){if(o.hasAttribute(O))continue;let p=l.appendChild(_());for(let s of o.getAttributeNames())p.setAttribute(s,o.getAttribute(s));p.querySelector("slot").replaceWith(...o.cloneNode(!0).childNodes);let r=p.querySelector(b);r&&(o.hasAttribute(M)?a={barItem:o,popupItem:p,checkbox:r}:(r.checked=o.hasAttribute(L),r.disabled=o.hasAttribute(v),t.push({barItem:o,popupItem:p,checkbox:r})))}return k(a,t),[t,a]},y=e=>{if(n?.bar===e)return;n&&E();let l=e.getBoundingClientRect(),t=R(),a=t.querySelector("slot"),[o,p]=w(e,a.parentElement);a.remove(),n={bar:e,popup:t,items:o,itemSelectedAll:p},e.classList.add(u),t.className=(t.className+" "+(e.getAttribute("data-popup-class")||"")).trim(),t.style.cssText=e.getAttribute("data-popup-style")||"",document.body.appendChild(t),t.classList.add(l.top*1.75>window.innerHeight&&l.bottom+t.offsetHeight>window.innerHeight?m:S),f(t,e);let r=(s,c)=>{if(s===p?.checkbox){for(let i of o)H(i,c);p.checkbox.checked=c,p.checkbox.indeterminate=!1}else{let i=o.find(T=>T.checkbox===s);if(!i)return;H(i,c),k(p,o)}f(t,e),e.dispatchEvent(new CustomEvent("change",{bubbles:!0,detail:{values:C(o)}}))};t.addEventListener("pointerover",s=>s.target.closest(I)?.querySelector(b)?.focus()),t.addEventListener("change",s=>{let c=s.target;c.matches(b)&&(r(c,c.checked),s.stopPropagation())}),t.addEventListener("keydown",s=>{let c=s.target;if(!c.matches(b))return;let i=s.keyCode;if(i===38||i===40){s.preventDefault();let T=i===38?"previousElementSibling":"nextElementSibling";for(let h=c.closest(I)?.[T];h;h=h[T]){let A=h.querySelector(b);if(!A?.disabled){A?.focus();break}}}else i===13&&(s.preventDefault(),r(c,!c.checked))}),setTimeout(()=>t.getElementsByTagName("input")[0]?.focus()),d.onOpen?.(n)};addEventListener("resize",()=>n&&f(n.popup,n.bar)),addEventListener("scroll",()=>n&&f(n.popup,n.bar)),addEventListener("pointerdown",e=>{let l=e.target,t=l.closest(g);t?t===n?.bar?E():y(t):n&&(n.popup.contains(l)?e.preventDefault():E())}),addEventListener("keydown",e=>{let l=e.target,t=e.keyCode;t===27&&n?(e.preventDefault(),E()):t===32&&l.matches(g)?(e.preventDefault(),l===n?.popup?E():y(l)):(t===38||t===40)&&l.matches(g)&&(e.preventDefault(),y(l))})};P({popupTemplate:"<ul><slot></slot></ul>",popupItemTemplate:"<li><label class=elab-label><input class=elab-checkbox type=checkbox><div class=elab-content><slot></slot></div></label></li>"});})();
